function user_dashboard(t){"use strict";function a(a,e,r){a.gettingUserDetails=!0;var n=r.get(document.location.origin+"/api/"+t,{catchError:!0,delay:1e4});n.promise.then(null,null,function(t){if(null!=t.data){o(t.data),a.userData=t.data,a.productsIntoAccount="";for(var e=a.userData.productsIntoAccount,n="",l=0;l<e.length;l++)n+=e[l].name,l<e.length-1&&(n+=", ");a.productsIntoAccount=n,a.gettingUserDetails=!1}else $("#errorMessage").append('<div class="alert alert-danger alert-dismissible"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">Ã—</button>There was a problem while getting latest data. Make sure you are connected to the internet and Make sure that it is working fine.</div>'),a.gettingUserDetails=!1,r.stopAll()});var o=function(t){var e=0;t.totalWeight>=1e6?(e=t.totalWeight/1e6,a.unit="Tonne(s)"):t.totalWeight>=1e3?(e=t.totalWeight/1e3,a.unit="KG(s)"):(e=t.totalWeight,a.unit="Gram(s)"),a.gettingUserDetails=!1,setTimeout(function(){$("#TotalWeight").text(e),$("#TotalProducts").text(t.totalProducts),$("#TotalLocation").text(t.totalLocation),$("#LastUpdatedProduct").text()!=t.lastUpdatedProduct&&($("#LastUpdatedProduct").fadeToggle(function(){$("#LastUpdatedProduct").text(t.lastUpdatedProduct)}),$("#LastUpdatedProduct").fadeToggle())},10)}}function e(a,e){a.isBusyChart1=!0,a.isBusyChart5=!0,e.get("/api/"+t+"/location_info").then(function(t){for(var e=t.data,n=0;n<e.length;n++)p.push(e[n].name),f.push(e[n].totalWeight);p.length>1&&p.push("All"),a.locations=p,a.selectedLocation=p[p.length-1],a.displayChart1(),a.isBusyChart5=!1,r()},function(t){a.chart1Error="Unable to display chart",a.isBusyChart1=!1,a.isBusyChart5=!1}),a.showMonthlyCharts=!0,a.chartClass="col-md-6",a.isBusyChart2=a.isBusyChart4=a.isBusyChart3=!0,e.get("/api/"+t+"/user_dates").then(function(r){if(h=r.data,h.length>1){for(var n=0;n<h.length;n++){var o=new Date(h[n]);d.push(y[o.getMonth()]+" "+o.getFullYear())}if(h.length>=g)var l=h.length-g;else var l=0;var i=h.length;a.monthLabels=d,a.chart2StartDate=d[l],a.chart2EndDate=d[i-1],e.get("/api/"+t+"/product_info").then(function(t){c(t.data),a.products=u,a.chart3ProductName=u[0],a.chart3StartDate=d[l],a.chart3EndDate=d[i-1],a.displayChart3()},function(t){a.chart3Error="Unable to display chart"}),a.chart4StartDate=d[l],a.chart4EndDate=d[i-1],a.displayChart2(),a.displayChart4()}else a.showMonthlyCharts=!1,a.chartClass="col-md-12"},function(t){a.chart2Error=a.chart3Error=a.chart4Error="Unable to display chart",a.isBusyChart2=a.isBusyChart3=a.isBusyChart4=!1}),a.displayChart1=function(){var r=[];if(a.isBusyChart1=!0,a.selectedLocation===p[p.length-1])e.get("/api/"+t+"/product_info").then(function(t){for(var e=t.data,n=0;n<e.length;n++)r.push(e[n]);a.isBusyChart1=!1,i(r)},function(t){a.chart1Error="Unable to display chart",a.isBusyChart1=!1});else for(var n=0;n<p.length;n++)p[n]==a.selectedLocation&&e.get("/api/"+t+"/"+p[n]+"/product_info").then(function(t){for(var e=t.data,n=0;n<e.length;n++)r.push(e[n]);a.isBusyChart1=!1,i(r)},function(t){a.chart1Error="Unable to display chart",a.isBusyChart1=!1})},a.displayChart2=function(){if(a.chart2StartDate==a.chart2EndDate)return a.chart2Error="Start month and end month must not have same value";for(var r,n,o=0;o<d.length;o++)d[o]===a.chart2StartDate?n=o:d[o]===a.chart2EndDate&&(r=o);if(n>r)return a.chart2Error="Start month must come before end month";a.isBusyChart2=!0;for(var i,s,o=0;o<h.length;o++)d[o]==a.chart2StartDate&&(i=new Date(h[o])),d[o]==a.chart2EndDate&&(s=new Date(h[o]));e.get("/api/"+t+"/product_info_month_wise/"+(i.getMonth()+1)+"/"+i.getFullYear()+"/"+(s.getMonth()+1)+"/"+s.getFullYear()).then(function(t){a.isBusyChart2=!1,a.chart2Error=l(a.chart2StartDate,a.chart2EndDate,t.data)},function(t){a.isBusyChart2=!1,a.chart2Error="Unable to display chart"})},a.displayChart3=function(){if(a.chart3StartDate==a.chart3EndDate)return a.chart3Error="Start month and end month must not have same value";for(var r,n,l=0;l<d.length;l++)d[l]===a.chart3StartDate?n=l:d[l]===a.chart3EndDate&&(r=l);if(n>r)return a.chart3Error="Start month must come before end month";a.isBusyChart3=!0;for(var i,s,l=0;l<h.length;l++)d[l]==a.chart3StartDate&&(i=new Date(h[l])),d[l]==a.chart3EndDate&&(s=new Date(h[l]));e.get("/api/"+t+"/product_info_month_wise/"+(i.getMonth()+1)+"/"+i.getFullYear()+"/"+(s.getMonth()+1)+"/"+s.getFullYear()).then(function(t){a.isBusyChart3=!1,a.chart3Error=o(a.chart3ProductName,a.chart3StartDate,a.chart3EndDate,t.data)},function(t){a.isBusyChart3=!1,a.chart3Error="Unable to display chart"})},a.displayChart4=function(){if(a.chart2StartDate==a.chart2EndDate)return a.chart4Error="Start month and end month must not have same value";for(var r,o,l=0;l<d.length;l++)d[l]===a.chart2StartDate?o=l:d[l]===a.chart2EndDate&&(r=l);if(o>r)return a.chart4Error="Start month must come before end month";a.isBusyChart4=!0;for(var i,s,l=0;l<h.length;l++)d[l]==a.chart4StartDate&&(i=new Date(h[l])),d[l]==a.chart4EndDate&&(s=new Date(h[l]));e.get("/api/"+t+"/product_info_month_wise/"+(i.getMonth()+1)+"/"+i.getFullYear()+"/"+(s.getMonth()+1)+"/"+s.getFullYear()).then(function(t){a.isBusyChart4=!1,a.chart4Error=n(a.chart4StartDate,a.chart4EndDate,t.data)},function(t){a.isBusyChart4=!1,a.chart4Error="Unable to display chart"})}}function r(){var t=[];if(1!=p.length)for(var a=0;a<p.length-1;a++)t.push(p[a]);else t.push(p[0]);var e={labels:t,datasets:[{data:f,backgroundColor:"#ff7272"}]},r={maintainAspectRatio:!1,scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Weight"},ticks:{beginAtZero:!0}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Locations"}}]},legend:{display:!1},tooltips:{enabled:!0,mode:"single",callbacks:{label:function(t,a){return t.xLabel<=1e3?t.xLabel+" gm":t.xLabel/1e3+" kg"}},displayColors:!1}},n=80*f.length;$("#chart5div").empty(),$("#chart5div").append('<canvas id="chart5" style="height:'+n+'px;" height="'+n+'" width="787"></canvas>');var o=document.getElementById("chart5").getContext("2d");new Chart(o,{type:"horizontalBar",data:e,options:r})}function n(t,a,e){function r(t){if(Array.isArray(t)){for(var a=0,e=Array(t.length);a<t.length;a++)e[a]=t[a];return e}return Array.from(t)}for(var n,o,l=0;l<d.length;l++)d[l]===t?o=l:d[l]===a&&(n=l);for(var i=function(t){return[].concat(r(new Set(t)))},s=function(t){return[].concat.apply([],t)},c=e.map(function(t){return t.date}),h=i(s(e.map(function(t){return t.productInformation})).map(function(t){return t.productName})),u=h.map(function(t){return{data:c.map(function(a){var r=e.find(function(t){return t.date===a}).productInformation.find(function(a){return a.productName===t});return r?r.totalWeight:0})}}),p=[],l=o;l<=n;l++)p.push(d[l]);for(var g=[],l=0;l<u[0].data.length;l++){for(var f=0,y=0;y<u.length;y++)f+=u[y].data[l];g.push(f)}var m={labels:p,datasets:[{label:"Weight in grams",data:g,backgroundColor:"#ff7272"}]},b={maintainAspectRatio:!1,scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Months"},ticks:{beginAtZero:!0}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Weight In Grams"}}]},legend:{display:!1},tooltips:{enabled:!0,mode:"single",callbacks:{label:function(t,a){return t.xLabel<=1e3?t.xLabel+" gm":t.xLabel/1e3+" kg"}},displayColors:!1}},v=0;v=e.length>15?250+Math.floor(100*e.length*.09):250,$("#chart4div").empty(),$("#chart4div").append('<canvas id="chart4" style="height: '+v+'px;" height="'+v+'" width="787"></canvas>');var C=document.getElementById("chart4").getContext("2d");new Chart(C,{type:"horizontalBar",data:m,options:b});return""}function o(t,a,e,r){for(var n,o,l=0;l<d.length;l++)d[l]===a?o=l:d[l]===e&&(n=l);for(var i=[],l=o;l<=n;l++)i.push(d[l]);for(var s,c=[],l=0;l<r.length;l++){for(s=0;s<r[l].productInformation.length;s++)if(r[l].productInformation[s].productName==t){c.push(r[l].productInformation[s].totalWeight);break}s==r[l].productInformation.length&&c.push(0)}var h=[{label:t,data:c,backgroundColor:"#f7ab40",borderWidth:5,borderColor:"#d68413",cubicInterpolationMode:"monotone"}],u={labels:i,datasets:h},p={maintainAspectRatio:!1,scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Products"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Weight In Grams"},ticks:{beginAtZero:!0}}]},legend:{display:!1,labels:{display:!1}},tooltips:{enabled:!0,mode:"single",callbacks:{label:function(t,a){return t.yLabel<=1e3?t.yLabel+" gm":t.yLabel/1e3+" kg"}},displayColors:!1}};$("#chart3div").empty(),$("#chart3div").append('<canvas id="chart3" style="height:250px;" height="250"></canvas>');var g=document.getElementById("chart3").getContext("2d");new Chart(g,{type:"line",data:u,options:p});return""}function l(t,a,e){function r(t){if(Array.isArray(t)){for(var a=0,e=Array(t.length);a<t.length;a++)e[a]=t[a];return e}return Array.from(t)}for(var n,o,l=0;l<d.length;l++)d[l]===t?o=l:d[l]===a&&(n=l);for(var i=function(t){return[].concat(r(new Set(t)))},c=function(t){return[].concat.apply([],t)},h=e.map(function(t){return t.date}),u=i(c(e.map(function(t){return t.productInformation})).map(function(t){return t.productName})),p=u.map(function(t){return{label:t,data:h.map(function(a){var r=e.find(function(t){return t.date===a}).productInformation.find(function(a){return a.productName===t});return r?r.totalWeight:0}),backgroundColor:s()}}),g=[],l=o;l<=n;l++)g.push(d[l]);var f={labels:g,datasets:p},y={maintainAspectRatio:!1,responsive:!0,legend:{display:!0,position:"top"},scales:{xAxes:[{display:!0,stacked:!0,scaleLabel:{display:!0,labelString:"Months"}}],yAxes:[{display:!0,stacked:!0,scaleLabel:{display:!0,labelString:"Weight In Grams"}}]},tooltips:{enabled:!0,mode:"single",callbacks:{label:function(t,a){return t.yLabel<=1e3?a.datasets[t.datasetIndex].label+": "+t.yLabel+" gm":a.datasets[t.datasetIndex].label+": "+t.yLabel/1e3+" kg"}}}};$("#chart2div").empty(),$("#chart2div").append('<canvas id="chart2" style="height:300px;" height="300"></canvas>');var m=document.getElementById("chart2").getContext("2d");new Chart(m,{type:"bar",data:f,options:y});return""}function i(t){for(var a=[],e=[],r=0;r<t.length;r++)a.push(t[r].productName),e.push(t[r].totalWeight);var n={labels:a,datasets:[{label:"Weight in grams",data:e,backgroundColor:"#3c8dbc"}]},o={maintainAspectRatio:!1,scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Products"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Weight In Grams"},ticks:{beginAtZero:!0}}]},legend:{display:!1},tooltips:{enabled:!0,mode:"single",callbacks:{label:function(t,a){var e=t.yLabel;return e<=1e3?t.yLabel+" gm":t.yLabel/1e3+" kg"}},displayColors:!1}};$("#chart1div").empty(),$("#chart1div").append('<canvas id="chart1" style="height: 250px;" height="250" width="787"></canvas>');var l=document.getElementById("chart1").getContext("2d");new Chart(l,{type:"bar",data:n,options:o})}function s(){for(var t="0123456789ABCDEF",a="#",e=0;e<6;e++)a+=t[Math.floor(16*Math.random())];return a}function c(t){for(var a=0;a<t.length;a++)u.push(t[a].productName)}var h=[],d=[],u=[],p=[],g=8,f=[],y=["January","February","March","April","May","June","July","August","September","October","November","December"];angular.module("app-dashboard",["emguo.poller"]),angular.module("app-dashboard").controller("chartsController",["$scope","$http",e]),angular.module("app-dashboard").controller("userController",["$scope","$http","poller",a])}